---
phase: 01-release-audit
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - PREREQUISITES.md
autonomous: false

must_haves:
  truths:
    - "Container builds successfully with --no-cache flag"
    - "Tool runs in fresh container without user's personal config"
    - "Prerequisites document lists all dependencies with version requirements"
    - "Each prerequisite has a verification command"
  artifacts:
    - path: "PREREQUISITES.md"
      provides: "Installation prerequisites with verification commands"
      contains: "podman, version requirements, verification commands"
  key_links:
    - from: "PREREQUISITES.md"
      to: "Containerfile"
      via: "Listed dependencies match what Containerfile installs"
      critical: "Prerequisites must match actual requirements"
    - from: "fresh container test"
      to: "documented workflow"
      via: "podman build --no-cache && podman run"
      critical: "If it doesn't work clean, colleagues will fail"
---

<objective>
Verify the tool works in a fresh environment and document all prerequisites for team adoption.

Purpose: Prove the codebase works without personal config and create clear setup documentation
Output: PREREQUISITES.md file and verified fresh-environment functionality
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-release-audit/01-RESEARCH.md
@Containerfile
@agent-session
@entrypoint.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fresh container build and basic verification</name>
  <files>No files modified - testing only</files>
  <action>
Build and test the container from scratch to verify it works without any cached state.

Steps:
1. Remove any existing test images to ensure clean state:
   ```bash
   podman rmi claude-agent:test 2>/dev/null || true
   ```

2. Build container with no cache:
   ```bash
   podman build --no-cache -t claude-agent:test .
   ```
   Expected: Build completes successfully

   If build fails:
   - Document the failure point
   - Check if it's a network issue (installer script download)
   - Check if it's a dependency issue (missing package)

3. Test basic container startup (without user config):
   ```bash
   podman run --rm claude-agent:test bash -c "command -v zellij && command -v claude && echo 'Tools installed'"
   ```
   Expected: Both commands exist, outputs "Tools installed"

4. Test the entrypoint script runs without /config/.claude mounted:
   ```bash
   podman run --rm claude-agent:test /entrypoint.sh bash -c "echo 'Entrypoint works without config'"
   ```
   Expected: Should not error on missing /config/.claude

5. Verify claude --version works:
   ```bash
   podman run --rm claude-agent:test bash -c "claude --version"
   ```
   Expected: Outputs version string

Document any issues found. Do not modify source files in this task.
  </action>
  <verify>
```bash
podman run --rm claude-agent:test bash -c "command -v zellij && command -v claude && claude --version"
```
Exits successfully and shows claude version
  </verify>
  <done>Container builds from scratch and basic tools (zellij, claude) are installed and accessible</done>
</task>

<task type="auto">
  <name>Task 2: Create PREREQUISITES.md with verification commands</name>
  <files>PREREQUISITES.md</files>
  <action>
Create a prerequisites document that lists all dependencies needed to use agent-session.

The document must include:

1. **Host System Requirements**
   - Linux (specify tested distributions)
   - Podman version requirement (with version check command)
   - Bash version requirement (with version check command)

2. **User Configuration Requirements**
   - Claude API credentials: `~/.claude.json` with API key
   - Optional: Zellij config at `~/.config/zellij/`
   - Optional: Claude settings at `~/.claude/`

3. **Verification Commands**
   For each prerequisite, provide a command that:
   - Checks if the requirement is met
   - Shows clear pass/fail output
   - Provides guidance if check fails

Example format:
```markdown
## Host Prerequisites

### Podman

Container runtime for rootless containers.

**Required version:** 4.0+

**Verify:**
```bash
podman --version
# Expected: podman version 4.x.x or higher
```

**Install (Debian/Ubuntu):**
```bash
sudo apt install podman
```
```

Base the requirements on:
- What Containerfile expects from host
- What agent-session script requires
- What the research document recommends

Do NOT include:
- Requirements that are inside the container (nodejs, npm, etc. - those are container concerns)
- Optional nice-to-haves
- Development dependencies
  </action>
  <verify>
1. `test -f PREREQUISITES.md` - file exists
2. `grep -q "podman --version" PREREQUISITES.md` - has podman verification
3. `grep -q "~/.claude.json" PREREQUISITES.md` - mentions API config
  </verify>
  <done>PREREQUISITES.md exists with all host requirements and verification commands</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Fresh container build verification and PREREQUISITES.md documentation.
The container builds from scratch and basic functionality works.
Prerequisites document lists what colleagues need to install.
  </what-built>
  <how-to-verify>
1. Review PREREQUISITES.md:
   - Does it list all requirements you needed when you first set this up?
   - Are the verification commands correct?
   - Is anything missing?

2. Quick sanity check - run the verification commands from PREREQUISITES.md on your machine:
   ```bash
   podman --version
   bash --version
   test -f ~/.claude.json && echo "Claude config exists"
   ```

3. (Optional but recommended) Try on a colleague's machine or VM:
   - Follow PREREQUISITES.md exactly
   - Run `agent-session -n test $(pwd)`
   - Does it work without tribal knowledge?
  </how-to-verify>
  <resume-signal>Type "approved" if prerequisites are complete, or describe what's missing</resume-signal>
</task>

</tasks>

<verification>
1. Container builds with `podman build --no-cache -t claude-agent:test .`
2. Basic tools work: `podman run --rm claude-agent:test bash -c "zellij --version && claude --version"`
3. PREREQUISITES.md exists with verification commands
4. Human confirmed prerequisites are complete
</verification>

<success_criteria>
- Container builds successfully from scratch (no cached layers)
- Claude and Zellij are accessible in fresh container
- PREREQUISITES.md documents all host requirements
- Each prerequisite has a verification command
- Human verified the documentation is complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-release-audit/01-02-SUMMARY.md`
</output>
