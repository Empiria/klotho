---
phase: 05-documentation
plan: 02
type: execute
wave: 2
depends_on:
  - "05-01"
files_modified:
  - README.md
autonomous: true

must_haves:
  truths:
    - "All 5 subcommands documented with syntax and examples"
    - "Command reference uses collapsible details blocks"
    - "Troubleshooting section exists and is NOT collapsed"
    - "Common errors have symptom, cause, solution format"
  artifacts:
    - path: "README.md"
      provides: "Command reference"
      contains: "## Commands"
    - path: "README.md"
      provides: "Troubleshooting guide"
      contains: "## Troubleshooting"
  key_links:
    - from: "README.md command docs"
      to: "agent-session --help output"
      via: "consistent syntax and examples"
      pattern: "agent-session (start|stop|restart|ls|rm)"
    - from: "README.md troubleshooting"
      to: "PREREQUISITES.md troubleshooting"
      via: "consolidated error solutions"
      pattern: "podman: command not found"
---

<objective>
Add command reference with collapsible sections and troubleshooting guide to README.md.

Purpose: Provide comprehensive documentation for all commands and common error resolution.
Output: Complete README.md with full command reference and troubleshooting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-documentation/05-CONTEXT.md
@.planning/phases/05-documentation/05-RESEARCH.md
@.planning/phases/05-documentation/05-01-SUMMARY.md
@agent-session
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add command reference section with collapsible details</name>
  <files>README.md</files>
  <action>
Add "## Commands" section after Quick Start with collapsible details blocks for each command.

For each of the 5 subcommands (start, stop, restart, ls, rm), create a collapsible section:

**Structure per command:**
```markdown
### command-name

<details>
<summary>Brief one-line description</summary>

**Syntax:**
```
agent-session command [OPTIONS] [ARGS]
```

**Options:**
- `-x, --flag` - Description

**Examples:**
```bash
agent-session command example1
agent-session command example2
```

**Notes:**
- Relevant behavior notes

</details>
```

**Command details to document:**

1. **start** - Create or attach to session
   - Options: -a/--agent, -n/--name
   - Examples: basic, with name, with agent, multiple paths
   - Notes: Interactive menu if no -a flag, session persists across disconnects

2. **stop** - Stop a running session
   - Arg: SESSION_NAME (default: "default")
   - Examples: default, named
   - Notes: Idempotent (stopping stopped session succeeds)

3. **restart** - Start stopped session and reattach
   - Arg: SESSION_NAME (default: "default")
   - Examples: default, named
   - Notes: If already running, simply reattaches

4. **ls** - List all sessions
   - No arguments
   - Show expected output format with columns (NAME, AGENT, STATUS)
   - Example output showing running/stopped states

5. **rm** - Remove stopped session
   - Options: -f/--force
   - Arg: SESSION_NAME (default: "default")
   - Examples: with confirmation, with force
   - Notes: Cannot remove running session

**CRITICAL spacing (from RESEARCH.md):**
- Blank line after each `<summary>` tag before markdown content
- Blank line after each `</details>` tag

Pull exact syntax from agent-session script help text to ensure consistency.
  </action>
  <verify>
README.md Commands section:
- Contains 5 subsections (start, stop, restart, ls, rm)
- Each uses `<details>/<summary>` HTML tags
- Proper spacing (blank lines after summary and details tags)
- Examples are copy-paste safe
- Syntax matches agent-session --help output
  </verify>
  <done>
All 5 commands documented in collapsible detail blocks with syntax, options, examples, and notes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add troubleshooting section</name>
  <files>README.md</files>
  <action>
Add "## Troubleshooting" section at the end of README.md (after Commands).

**IMPORTANT:** This section must NOT be collapsed (per RESEARCH.md Pattern 4).

Include these common errors with symptom/cause/solution/verify structure:

1. **"podman: command not found"**
   - Cause: Podman not installed
   - Solution: Install commands for Linux (apt) and macOS (brew)
   - Verify: `podman --version`

2. **"Cannot connect to Podman" or "unable to connect to Podman socket" (macOS)**
   - Cause: Podman machine not running
   - Solution: `podman machine start`
   - Verify: `podman machine list`

3. **"Error: unable to look up current user"** or UID mapping errors
   - Cause: Podman rootless setup incomplete
   - Solution: Check /etc/subuid and /etc/subgid, run `podman system migrate`
   - Verify: `podman run --rm alpine id`

4. **"session 'X' not found"**
   - Cause: Session doesn't exist or typo in name
   - Solution: `agent-session ls` to see available sessions
   - Verify: List output

5. **"cannot remove running session"**
   - Cause: Trying to rm a running session
   - Solution: `agent-session stop NAME` first
   - Verify: Session stopped in `agent-session ls`

6. **Image not built / "Image not built. Build now?"**
   - Cause: First time using agent, image not built yet
   - Solution: Answer 'y' to prompt or run `./scripts/build.sh AGENT`
   - Note: First build takes 2-3 minutes

Format each entry with clear headings using the error message as the heading.
Keep solutions actionable with exact commands.
  </action>
  <verify>
README.md Troubleshooting section:
- NOT wrapped in `<details>` tags (visible by default)
- Contains at least 5 error entries
- Each has symptom heading, cause, solution with commands, verification
- Covers both Linux and macOS-specific issues
  </verify>
  <done>
Troubleshooting section complete with common errors and solutions, not collapsed.
  </done>
</task>

<task type="auto">
  <name>Task 3: Final review and cleanup</name>
  <files>README.md</files>
  <action>
Review complete README.md for:

1. **Section order** (per CONTEXT.md and RESEARCH.md):
   - Title/Overview
   - Prerequisites
   - Concepts
   - Quick Start
   - Commands
   - Troubleshooting

2. **Consistency checks**:
   - Command names match between quick start and command reference
   - Flag names consistent (-a vs --agent used appropriately)
   - Session name default ("default") mentioned consistently

3. **Copy-paste safety**:
   - Scan all code blocks for brackets [], pipes |, ellipses ..., inline comments
   - Replace any non-copy-pasteable patterns with concrete examples

4. **Link placeholders**:
   - Ensure git clone URL has placeholder comment or real URL
   - External links (podman.io, etc.) are valid

5. **Remove redundancy**:
   - PREREQUISITES.md content is now in README - consider adding note that PREREQUISITES.md exists for detailed reference

Make any necessary corrections found during review.
  </action>
  <verify>
Complete README.md:
- Correct section order
- No copy-paste breaking patterns in code blocks
- Consistent terminology throughout
- All 6 main sections present
  </verify>
  <done>
README.md is complete, consistent, and ready for use. All sections present in correct order.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. README.md contains all 6 sections in correct order
2. Commands section has 5 collapsible subsections with proper HTML spacing
3. Troubleshooting is NOT collapsed
4. All code examples are copy-paste safe
5. Document is scannable - quick start visible without scrolling past walls of text
</verification>

<success_criteria>
- README.md provides complete documentation for agent-session
- All commands documented with consistent syntax and examples
- Common errors have clear troubleshooting paths
- Document structure follows RESEARCH.md patterns (collapsible commands, visible troubleshooting)
</success_criteria>

<output>
After completion, create `.planning/phases/05-documentation/05-02-SUMMARY.md`
</output>
