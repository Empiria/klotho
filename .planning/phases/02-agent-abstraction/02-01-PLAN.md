---
phase: 02-agent-abstraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - config/agents/claude/config.conf
  - docs/AGENTS.md
autonomous: true

must_haves:
  truths:
    - "Claude agent has a config file defining its name, description, install command, launch command, shell, and required mounts"
    - "AGENTS.md documents all config fields with purpose and examples"
    - "Config file format is shell-sourceable with only KEY=value and variable expansion"
  artifacts:
    - path: "config/agents/claude/config.conf"
      provides: "Claude agent definition"
      contains: "AGENT_NAME"
    - path: "docs/AGENTS.md"
      provides: "Agent config reference documentation"
      contains: "Required Fields"
  key_links:
    - from: "config/agents/claude/config.conf"
      to: "docs/AGENTS.md"
      via: "field definitions match documentation"
      pattern: "AGENT_NAME|AGENT_DESCRIPTION|AGENT_INSTALL_CMD"
---

<objective>
Create the agent config format and Claude agent definition.

Purpose: Establish the config-driven architecture foundation that enables adding new agents via config files instead of code changes.
Output: Claude agent config file and AGENTS.md reference documentation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-agent-abstraction/02-CONTEXT.md
@.planning/phases/02-agent-abstraction/02-RESEARCH.md

# Current implementation to extract values from
@Containerfile
@entrypoint.sh
@agent-session
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Claude agent config file</name>
  <files>config/agents/claude/config.conf</files>
  <action>
Create directory structure `config/agents/claude/` and config file.

Extract current Claude-specific values from Containerfile and agent-session:
- AGENT_NAME="claude"
- AGENT_DESCRIPTION="Anthropic Claude Code agent"
- AGENT_INSTALL_CMD="curl -fsSL https://claude.ai/install.sh | bash"
- AGENT_LAUNCH_CMD="claude --dangerously-skip-permissions"
- AGENT_SHELL="/usr/bin/fish"
- AGENT_REQUIRED_MOUNTS="/workspace /config/.claude /config/zellij"
- AGENT_ENV_VARS="PATH=/home/agent/.local/bin:$PATH SHELL=/usr/bin/fish"

Format: Shell-sourceable KEY=value with comments explaining each field.
No command substitution ($() or backticks) - only variable expansion ($VAR, ${VAR}).
  </action>
  <verify>
- `source config/agents/claude/config.conf` succeeds without errors
- `echo $AGENT_NAME` outputs "claude"
- `grep -E '\$\(|`' config/agents/claude/config.conf` returns no matches (no command substitution)
  </verify>
  <done>Config file exists, is sourceable, contains all required fields with correct values extracted from current implementation.</done>
</task>

<task type="auto">
  <name>Task 2: Create AGENTS.md reference documentation</name>
  <files>docs/AGENTS.md</files>
  <action>
Create `docs/` directory and `AGENTS.md` documenting the agent config format.

Include:
1. Overview: What agent configs are for and where they live
2. Directory structure: `config/agents/<agent-name>/config.conf` with XDG override path
3. Required fields table:
   - AGENT_NAME: Agent identifier (must match directory name and Containerfile stage)
   - AGENT_DESCRIPTION: Human-readable description for menus/help
   - AGENT_INSTALL_CMD: Command to install the agent in container
   - AGENT_LAUNCH_CMD: Command to start the agent
   - AGENT_SHELL: Default shell for the agent (full path)
   - AGENT_REQUIRED_MOUNTS: Space-separated mount paths
   - AGENT_ENV_VARS: Space-separated KEY=value environment variables
4. Example: Show claude config as reference
5. Adding a new agent: Checklist (create config, add Containerfile stage, rebuild)
6. Security note: No command substitution allowed, validation rejects $() and backticks

Keep documentation concise - this is a reference, not a tutorial.
  </action>
  <verify>
- File exists at `docs/AGENTS.md`
- Contains "Required Fields" section
- Contains example showing AGENT_NAME, AGENT_INSTALL_CMD
- References XDG override path `~/.config/agent-session/agents/`
  </verify>
  <done>AGENTS.md exists with all required fields documented, example config shown, and security note about validation.</done>
</task>

</tasks>

<verification>
Phase verification:
- `ls config/agents/claude/config.conf docs/AGENTS.md` shows both files exist
- `source config/agents/claude/config.conf && echo "$AGENT_NAME"` outputs "claude"
- Config matches current Containerfile behavior (same install command, shell, paths)
</verification>

<success_criteria>
- Claude agent config file exists with all required fields
- AGENTS.md documents the config format completely
- Config file is shell-sourceable without errors
- No command substitution in config file (security requirement)
</success_criteria>

<output>
After completion, create `.planning/phases/02-agent-abstraction/02-01-SUMMARY.md`
</output>
