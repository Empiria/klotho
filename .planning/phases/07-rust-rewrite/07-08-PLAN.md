---
phase: 07-rust-rewrite
plan: 08
type: execute
wave: 5
depends_on: ["07-04", "07-05", "07-06", "07-07"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All commands work end-to-end"
    - "Rust binary matches bash version behavior"
    - "Build and release pipeline works"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of Rust CLI against bash version behavior.

Purpose: Ensure Rust implementation is feature-complete and ready to replace bash version.
Output: Verified working Rust CLI, ready for release.
</objective>

<execution_context>
@/home/owen/.claude/get-shit-done/workflows/execute-plan.md
@/home/owen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-rust-rewrite/07-04-SUMMARY.md
@.planning/phases/07-rust-rewrite/07-05-SUMMARY.md
@.planning/phases/07-rust-rewrite/07-06-SUMMARY.md
@.planning/phases/07-rust-rewrite/07-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build release binary and run automated tests</name>
  <files></files>
  <action>
Build release binary and test all commands:

```bash
# Build release binary
cargo build --release

# Test help text for all commands
./target/release/klotho --help
./target/release/klotho start --help
./target/release/klotho stop --help
./target/release/klotho restart --help
./target/release/klotho ls --help
./target/release/klotho rm --help
./target/release/klotho build --help
./target/release/klotho rebuild --help

# Test version
./target/release/klotho --version

# Test ls (should work even with no sessions)
./target/release/klotho ls

# Test build (with claude agent)
./target/release/klotho build claude

# Test error handling
./target/release/klotho stop nonexistent || echo "Expected error"
./target/release/klotho rm nonexistent || echo "Expected error"
```

Capture all outputs and verify:
- Help text is clear and complete
- Error messages are helpful
- Build produces working image
  </action>
  <verify>All commands produce expected output without crashes</verify>
  <done>Automated testing passes for all commands</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Rust CLI implementation with all commands: start, stop, restart, ls, rm, build, rebuild</what-built>
  <how-to-verify>
Test the full session lifecycle:

1. Build the Rust binary:
   ```bash
   cargo build --release
   ```

2. Test build command:
   ```bash
   ./target/release/klotho build claude
   ```
   Expected: Spinner progress, successful build

3. Test start command:
   ```bash
   ./target/release/klotho start -n rust-test ~/projects/some-project
   ```
   Expected: Container created, Zellij session attached

4. Detach from Zellij (Ctrl+Q d) and test ls:
   ```bash
   ./target/release/klotho ls
   ```
   Expected: Shows "rust-test" with "running" status in green

5. Test stop:
   ```bash
   ./target/release/klotho stop rust-test
   ```
   Expected: "Stopped: rust-test"

6. Test restart:
   ```bash
   ./target/release/klotho restart rust-test
   ```
   Expected: Container starts, Zellij reattaches

7. Detach and test rm:
   ```bash
   ./target/release/klotho stop rust-test
   ./target/release/klotho rm rust-test
   ```
   Expected: Confirmation prompt, then "Removed: rust-test"

8. Compare with bash version:
   - Run same workflow with ./klotho (bash)
   - Verify behavior matches

9. Test interactive agent selection:
   ```bash
   ./target/release/klotho start -n interactive-test
   ```
   Expected: Agent selection menu appears (if multiple agents)

10. Test legacy container detection:
    - If any legacy containers exist (claude-* or opencode-*), verify Rust version detects them
  </how-to-verify>
  <resume-signal>Type "verified" when all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Full session lifecycle tested:
- build creates image with progress
- start creates container and attaches
- ls shows sessions with status
- stop stops container
- restart starts and reattaches
- rm removes with confirmation

Behavior matches bash version for all existing commands.
New build/rebuild commands work as designed.
</verification>

<success_criteria>
All Phase 7 success criteria from ROADMAP.md verified:
1. [x] Rust CLI provides all commands from bash version plus build/rebuild
2. [x] Single static binary with no runtime dependencies (verified with musl build)
3. [x] Argument parsing and help text matches bash version
4. [x] Config file loading works identically
5. [x] Podman container management works correctly
6. [x] Zellij session attachment works correctly
7. [x] Legacy naming migration continues to work
8. [x] GitHub releases configured for pre-built binaries
9. [x] curl | sh installer script available
</success_criteria>

<output>
After completion, create `.planning/phases/07-rust-rewrite/07-08-SUMMARY.md`
</output>
